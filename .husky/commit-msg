#!/bin/sh

# Prevent AI co-authored-by trailers in commits
# This is required for EasyCLA compliance - AI agents cannot sign CLAs
#
# See CLAUDE.md and AGENTS.md for more information

COMMIT_MSG_FILE="$1"

# Pattern matching common AI assistants (case-insensitive)
# Includes: Claude, Cursor, Copilot, ChatGPT, Gemini, Cody, etc.
AI_PATTERN="claude|anthropic|cursor|copilot|chatgpt|openai|gpt-[34]|gemini|bard|codewhisperer|tabnine|cody|ai-assistant|noreply@anthropic|noreply@cursor|noreply@openai|cursoragent"

# Automatically remove AI co-authored-by trailers
# This is required for EasyCLA compliance - AI agents cannot sign CLAs
if grep -iE "^Co-[Aa]uthored-[Bb]y:.*($AI_PATTERN)" "$COMMIT_MSG_FILE" > /dev/null 2>&1; then
    # Create a temporary file with cleaned content
    TEMP_FILE=$(mktemp)
    grep -viE "^Co-[Aa]uthored-[Bb]y:.*($AI_PATTERN)" "$COMMIT_MSG_FILE" > "$TEMP_FILE"
    mv "$TEMP_FILE" "$COMMIT_MSG_FILE"
    echo ""
    echo "WARNING: AI co-author trailer automatically removed from commit message."
    echo "This project uses EasyCLA for FINOS compliance - AI assistants cannot"
    echo "sign Contributor License Agreements."
    echo ""
fi

# Also check for generated-with footers that might cause issues
if grep -iE "Generated.*(with|by).*(Claude|Cursor|Copilot|ChatGPT|AI)" "$COMMIT_MSG_FILE" > /dev/null 2>&1; then
    echo ""
    echo "WARNING: AI generation footer detected in commit message!"
    echo ""
    echo "Lines like 'Generated with Claude Code' may cause EasyCLA issues."
    echo "Consider removing this line from your commit message."
    echo ""
    # This is a warning only, not blocking
fi

exit 0
