#!/bin/sh

echo "Running pre-push checks..."

# Ensure mise is available
if ! command -v mise > /dev/null 2>&1; then
    echo "Error: mise is not installed."
    echo "Install mise from: https://mise.jdx.dev/"
    echo "Or run: curl https://mise.jdx.dev/install.sh | sh"
    exit 1
fi

# Check formatting using mise task
echo "Checking Go formatting..."
mise run fmt-check || {
    echo ""
    echo "Run 'mise run fmt' to fix formatting issues."
    exit 1
}
echo "Formatting check passed."

# Run linting using mise task
echo "Running linters..."
mise run lint || {
    echo "Linting failed."
    exit 1
}
echo "Linting passed."

# Run tests using mise task
echo "Running tests..."
mise run test || {
    echo "Tests failed."
    exit 1
}
echo "Tests passed."

echo "All pre-push checks passed!"
