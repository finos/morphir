language: typescript
type: application
platform: node

fileGroups:
  vite:
    - "**/*.ts"
    - "**/*.tsx"
    - "src/**/*.js"
    - "src/**/*.jsx"
    - "src/**/*.elm"
  elmSources:
    - "src"
tags:
  - "elm"

tasks:
  bundle-components:
    command: "vite build --ssr"
    args:
      - "--config"
      - "vite.config.component.ts"
    inputs:
      - "@globs(vite)"
      - "vite.config.component.ts"
    outputs:
      - "out/components/"
  bundle:
    command: "vite build --ssr"
    inputs:
      - "@globs(vite)"
      - "vite.config.ts"
    outputs:
      - "dist"
  #TODO: Remove component bundling if we don't concretely go with ComponetizeJS and embedding the morphir-elm compiler via Wasm
  build:
    deps:
      - target: "~:bundle"
      - target: "~:bundle-components"

  clean-out:
    command: "rm"
    args:
      - "-rf"
      - "out"
    inputs: ["out"]
    options:
      cache: false

  clean-dist:
    command: "rm"
    args:
      - "-rf"
      - "dist"
    inputs: ["dist"]
    options:
      cache: false

  clean:
    deps:
      - target: "~:clean-out"
      - target: "~:clean-dist"
