---
title: "Schema Checker"
sidebar_label: "Schema Checker"
sidebar_position: 1
description: "Validate Morphir IR JSON against official schemas"
---

import React from "react";
import JsonView from "@uiw/react-json-view";
import { githubDarkTheme } from "@uiw/react-json-view/githubDark";
import { githubLightTheme } from "@uiw/react-json-view/githubLight";
import Editor from "@monaco-editor/react";
import { useColorMode } from "@docusaurus/theme-common";
import Ajv from "ajv";
import addFormats from "ajv-formats";

# Morphir IR Schema Checker

Validate your Morphir IR JSON files against the official JSON schemas. This tool helps ensure your IR files are correctly formatted and compatible with Morphir tooling.

## How to Use

1. **Select a schema version** (v1, v2, v3, or v4)
2. **Paste your Morphir IR JSON** in the Monaco editor or upload a file
3. **Click Validate** to check your JSON against the schema
4. View validation results with detailed error messages

export const SchemaChecker = () => {
  const [selectedVersion, setSelectedVersion] = React.useState('v4');
  const [jsonInput, setJsonInput] = React.useState('');
  const [validationResult, setValidationResult] = React.useState(null);
  const [isValidating, setIsValidating] = React.useState(false);
  const [schemas, setSchemas] = React.useState({});
  const [loadError, setLoadError] = React.useState(null);
  const { colorMode } = useColorMode();
  const fileInputRef = React.useRef(null);
  const editorRef = React.useRef(null);

  const schemaVersions = [
    { value: 'v1', label: 'Version 1', file: 'morphir-ir-v1.json' },
    { value: 'v2', label: 'Version 2', file: 'morphir-ir-v2.json' },
    { value: 'v3', label: 'Version 3 (Stable)', file: 'morphir-ir-v3.json' },
    { value: 'v4', label: 'Version 4 (Draft)', file: 'morphir-ir-v4.json' },
  ];

  React.useEffect(() => {
    const loadSchemas = async () => {
      try {
        const loadedSchemas = {};
        for (const version of schemaVersions) {
          const response = await fetch(`/schemas/${version.file}`);
          if (response.ok) {
            loadedSchemas[version.value] = await response.json();
          }
        }
        setSchemas(loadedSchemas);
      } catch (err) {
        setLoadError(`Failed to load schemas: ${err.message}`);
      }
    };
    loadSchemas();
  }, []);

  const handleEditorDidMount = (editor, monaco) => {
    editorRef.current = editor;
    // Configure JSON language features
    monaco.languages.json.jsonDefaults.setDiagnosticsOptions({
      validate: true,
      allowComments: false,
      schemaValidation: 'error',
    });
  };

  const handleFileUpload = (event) => {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        setJsonInput(e.target.result);
        setValidationResult(null);
      };
      reader.readAsText(file);
    }
  };

  const validateJson = async () => {
    setIsValidating(true);
    setValidationResult(null);

    try {
      let parsedJson;
      try {
        parsedJson = JSON.parse(jsonInput);
      } catch (parseErr) {
        setValidationResult({
          valid: false,
          errors: [{ message: `JSON Parse Error: ${parseErr.message}` }],
          parsedJson: null,
        });
        setIsValidating(false);
        return;
      }

      const schema = schemas[selectedVersion];
      if (!schema) {
        setValidationResult({
          valid: false,
          errors: [{ message: `Schema for ${selectedVersion} not loaded` }],
          parsedJson,
        });
        setIsValidating(false);
        return;
      }

      const ajv = new Ajv({ allErrors: true, verbose: true, strict: false });
      addFormats(ajv);
      const validate = ajv.compile(schema);
      const valid = validate(parsedJson);

      setValidationResult({
        valid,
        errors: validate.errors || [],
        parsedJson,
        schemaVersion: selectedVersion,
      });
    } catch (err) {
      setValidationResult({
        valid: false,
        errors: [{ message: `Validation Error: ${err.message}` }],
        parsedJson: null,
      });
    }

    setIsValidating(false);
  };

  const sampleJson = {
    v4: `{
  "formatVersion": 4,
  "distribution": {
    "Library": {
      "packageName": "my-org/my-package",
      "dependencies": {},
      "def": {
        "modules": {}
      }
    }
  }
}`,
    v3: `[
  "Library",
  [["my", "org"], ["my", "package"]],
  {},
  { "modules": [] }
]`,
    v2: `[
  "Library",
  [["my", "org"], ["my", "package"]],
  {},
  { "modules": [] }
]`,
    v1: `[
  "library",
  [["my", "org"], ["my", "package"]],
  {},
  { "modules": [] }
]`,
  };

  if (loadError) {
    return <div className="alert alert--danger">{loadError}</div>;
  }

  return (
    <div>
      {/* Version Selection */}
      <div style={{ marginBottom: '1rem' }}>
        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>
          Schema Version:
        </label>
        <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
          {schemaVersions.map((v) => (
            <button
              key={v.value}
              onClick={() => {
                setSelectedVersion(v.value);
                setValidationResult(null);
              }}
              style={{
                padding: '0.5rem 1rem',
                cursor: 'pointer',
                border: '1px solid var(--ifm-color-emphasis-300)',
                borderRadius: '4px',
                backgroundColor: selectedVersion === v.value
                  ? 'var(--ifm-color-primary)'
                  : 'var(--ifm-background-surface-color)',
                color: selectedVersion === v.value ? 'white' : 'var(--ifm-font-color-base)',
                fontWeight: selectedVersion === v.value ? 'bold' : 'normal',
              }}
            >
              {v.label}
            </button>
          ))}
        </div>
      </div>

      {/* File Upload and Sample Buttons */}
      <div style={{ marginBottom: '1rem' }}>
        <input
          type="file"
          ref={fileInputRef}
          onChange={handleFileUpload}
          accept=".json"
          style={{ display: 'none' }}
        />
        <button
          onClick={() => fileInputRef.current?.click()}
          style={{
            padding: '0.5rem 1rem',
            cursor: 'pointer',
            border: '1px solid var(--ifm-color-emphasis-300)',
            borderRadius: '4px',
            backgroundColor: 'var(--ifm-background-surface-color)',
            color: 'var(--ifm-font-color-base)',
            marginRight: '0.5rem',
          }}
        >
          Upload JSON File
        </button>
        <button
          onClick={() => {
            setJsonInput(sampleJson[selectedVersion]);
            setValidationResult(null);
          }}
          style={{
            padding: '0.5rem 1rem',
            cursor: 'pointer',
            border: '1px solid var(--ifm-color-emphasis-300)',
            borderRadius: '4px',
            backgroundColor: 'var(--ifm-background-surface-color)',
            color: 'var(--ifm-font-color-base)',
          }}
        >
          Load Sample ({selectedVersion})
        </button>
      </div>

      {/* Monaco Editor for JSON Input */}
      <div style={{ marginBottom: '1rem' }}>
        <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>
          Morphir IR JSON (Monaco Editor):
        </label>
        <div style={{ border: '1px solid var(--ifm-color-emphasis-300)', borderRadius: '4px' }}>
          <Editor
            height="400px"
            language="json"
            value={jsonInput}
            onChange={(value) => {
              setJsonInput(value || '');
              setValidationResult(null);
            }}
            onMount={handleEditorDidMount}
            theme={colorMode === 'dark' ? 'vs-dark' : 'light'}
            options={{
              minimap: { enabled: true },
              lineNumbers: 'on',
              scrollBeyondLastLine: false,
              wordWrap: 'on',
              automaticLayout: true,
              fontSize: 14,
              folding: true,
              formatOnPaste: true,
              tabSize: 2,
            }}
          />
        </div>
      </div>

      {/* Validate Button */}
      <div style={{ marginBottom: '1rem' }}>
        <button
          onClick={validateJson}
          disabled={isValidating || !jsonInput.trim()}
          style={{
            padding: '0.75rem 2rem',
            cursor: isValidating || !jsonInput.trim() ? 'not-allowed' : 'pointer',
            border: 'none',
            borderRadius: '4px',
            backgroundColor: isValidating || !jsonInput.trim()
              ? 'var(--ifm-color-emphasis-300)'
              : 'var(--ifm-color-primary)',
            color: 'white',
            fontWeight: 'bold',
            fontSize: '1rem',
          }}
        >
          {isValidating ? 'Validating...' : 'Validate JSON'}
        </button>
      </div>

      {/* Validation Results */}
      {validationResult && (
        <div>
          {validationResult.valid ? (
            <div className="alert alert--success" style={{ marginBottom: '1rem' }}>
              <strong>Valid!</strong> Your JSON conforms to the Morphir IR {validationResult.schemaVersion} schema.
            </div>
          ) : (
            <div className="alert alert--danger" style={{ marginBottom: '1rem' }}>
              <strong>Invalid!</strong> Found {validationResult.errors.length} error(s):
              <ul style={{ marginTop: '0.5rem', marginBottom: 0 }}>
                {validationResult.errors.slice(0, 10).map((err, i) => (
                  <li key={i} style={{ fontFamily: 'monospace', fontSize: '0.9rem' }}>
                    {err.instancePath && <strong>{err.instancePath}: </strong>}
                    {err.message}
                    {err.params && Object.keys(err.params).length > 0 && (
                      <span style={{ color: 'var(--ifm-color-emphasis-600)' }}>
                        {' '}({JSON.stringify(err.params)})
                      </span>
                    )}
                  </li>
                ))}
                {validationResult.errors.length > 10 && (
                  <li>...and {validationResult.errors.length - 10} more errors</li>
                )}
              </ul>
            </div>
          )}

          {validationResult.parsedJson && (
            <div>
              <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 'bold' }}>
                Parsed JSON Tree:
              </label>
              <JsonView
                value={validationResult.parsedJson}
                style={colorMode === 'dark' ? githubDarkTheme : githubLightTheme}
                displayDataTypes={false}
                collapsed={2}
              />
            </div>
          )}
        </div>
      )}
    </div>
  );
};

<SchemaChecker />

## Schema Versions

| Version | Status | Description |
|---------|--------|-------------|
| **v4** | Draft | Next-generation format with wrapper objects and explicit attributes |
| **v3** | Stable | Current production version with capitalized tags |
| **v2** | Legacy | Transitional version with mixed capitalization |
| **v1** | Legacy | Original format with lowercase tags |

## Schema Downloads

- **Version 4**: [JSON](/schemas/morphir-ir-v4.json) | [YAML](/schemas/morphir-ir-v4.yaml)
- **Version 3**: [JSON](/schemas/morphir-ir-v3.json) | [YAML](/schemas/morphir-ir-v3.yaml)
- **Version 2**: [JSON](/schemas/morphir-ir-v2.json) | [YAML](/schemas/morphir-ir-v2.yaml)
- **Version 1**: [JSON](/schemas/morphir-ir-v1.json) | [YAML](/schemas/morphir-ir-v1.yaml)

## Version-Specific Checkers

For version-specific validation with detailed schema browsing:

- [Version 4 Schema Checker](/docs/spec/ir/schemas/v4/full/schema-checker)
- [Version 3 Schema Checker](/docs/spec/ir/schemas/v3/full/schema-checker)
- [Version 2 Schema Checker](/docs/spec/ir/schemas/v2/full/schema-checker)
- [Version 1 Schema Checker](/docs/spec/ir/schemas/v1/full/schema-checker)

## See Also

- [Morphir IR Specification](/docs/spec/ir/morphir-ir-specification)
- [Schema Overview](/docs/spec/ir/schemas/)
- [Migration Guide](/docs/spec/ir/schemas/migration-guide)
