// WASI Sockets - simplified version for testing
package wasi:sockets@0.2.0;

interface network {
    // Error codes for network operations
    enum error-code {
        unknown,
        access-denied,
        not-supported,
        invalid-argument,
        out-of-memory,
        timeout,
        concurrency-conflict,
        would-block,
        address-family-not-supported,
        address-in-use,
        address-not-bindable,
        connection-refused,
        connection-reset,
        connection-aborted,
        datagram-too-large,
        name-unresolvable,
        temporary-resolver-failure,
        permanent-resolver-failure,
    }

    // IP address family
    enum ip-address-family {
        ipv4,
        ipv6,
    }

    // IPv4 address as tuple of octets
    record ipv4-address {
        a: u8,
        b: u8,
        c: u8,
        d: u8,
    }

    // IPv6 address
    record ipv6-address {
        a: u16,
        b: u16,
        c: u16,
        d: u16,
        e: u16,
        f: u16,
        g: u16,
        h: u16,
    }

    // IP address variant
    variant ip-address {
        ipv4(ipv4-address),
        ipv6(ipv6-address),
    }

    // Socket address with IP and port
    record ip-socket-address {
        address: ip-address,
        port: u16,
    }

    // Network resource
    resource network {
    }
}

interface tcp {
    use network.{network, error-code, ip-socket-address};

    // TCP socket resource
    resource tcp-socket {
        start-bind: func(network: borrow<network>, local-address: ip-socket-address) -> result<_, error-code>;
        finish-bind: func() -> result<_, error-code>;
        start-connect: func(network: borrow<network>, remote-address: ip-socket-address) -> result<_, error-code>;
        finish-connect: func() -> result<tuple<u32, u32>, error-code>;
        start-listen: func() -> result<_, error-code>;
        finish-listen: func() -> result<_, error-code>;
        accept: func() -> result<tuple<tcp-socket, u32, u32>, error-code>;
        local-address: func() -> result<ip-socket-address, error-code>;
        remote-address: func() -> result<ip-socket-address, error-code>;
        shutdown: func(shutdown-type: u8) -> result<_, error-code>;
    }
}

world sockets {
    import network;
    import tcp;
}
