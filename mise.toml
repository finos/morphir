[tools]
# Core tools
go = "1.25.5"
python = "3.14.2"

# JavaScript runtimes and package managers (for toolchain backend tests)
node = "24"      # Provides npm and npx
bun = "latest"   # Provides bunx
deno = "latest"  # Provides deno run npm:
yarn = "4"       # Provides yarn dlx (Yarn Berry)
pnpm = "latest"  # Provides pnpm dlx

# Development tools
golangci-lint = "latest"  # Go linter aggregator

# =============================================================================
# Documentation Tasks
# =============================================================================

[tasks."llms-txt"]
description = "Generate llms.txt and llms-full.txt files"
run = "python .claude/skills/technical-writer/scripts/generate_llms_txt.py"

[tasks."llms-txt:compact"]
description = "Generate only llms.txt (compact version)"
run = "python .claude/skills/technical-writer/scripts/generate_llms_txt.py --compact-only"

[tasks."llms-txt:full"]
description = "Generate only llms-full.txt (full version)"
run = "python .claude/skills/technical-writer/scripts/generate_llms_txt.py --full-only"

[tasks."llms-txt:preview"]
description = "Preview llms.txt generation without writing files"
run = "python .claude/skills/technical-writer/scripts/generate_llms_txt.py --dry-run"

# =============================================================================
# Schema Tasks
# =============================================================================

[tasks."schema:convert"]
description = "Convert YAML JSON Schema files to JSON format"
run = "python .claude/skills/technical-writer/scripts/convert_schema.py website/static/schemas/"

[tasks."schema:verify"]
description = "Verify YAML and JSON schema files are in sync"
run = "python .claude/skills/technical-writer/scripts/convert_schema.py --verify website/static/schemas/"

[tasks."schema:drift"]
description = "Check for drift between schema and implementation"
run = "python .claude/skills/technical-writer/scripts/check_schema_drift.py --all"

# =============================================================================
# Test Fixtures Tasks
# =============================================================================

[tasks."fixtures:list"]
description = "List available morphir-ir fixtures"
run = "python .claude/skills/morphir-developer/scripts/fetch_morphir_ir.py --list"

[tasks."fixtures:fetch"]
description = "Fetch all morphir-ir fixtures from morphir-elm"
run = "python .claude/skills/morphir-developer/scripts/fetch_morphir_ir.py --all --output tests/bdd/testdata/morphir-ir"

[tasks."fixtures:fetch:rentals"]
description = "Fetch the rentals fixture from morphir-elm"
run = "python .claude/skills/morphir-developer/scripts/fetch_morphir_ir.py rentals --output tests/bdd/testdata/morphir-ir"

[tasks."fixtures:fetch:version"]
description = "Fetch fixtures from a specific morphir-elm version (use MORPHIR_VERSION env var)"
run = "python .claude/skills/morphir-developer/scripts/fetch_morphir_ir.py --all --version ${MORPHIR_VERSION:-v2.100.0} --output tests/bdd/testdata/morphir-ir"

# =============================================================================
# Integration Test Tasks
# =============================================================================

[tasks."test:integration"]
description = "Run all integration tests (requires Node.js via mise)"
run = """
for dir in pkg/toolchain pkg/bindings/morphir-elm; do
  if [ -d "$dir" ]; then
    echo "Running integration tests in $dir..."
    go test -v -run 'TestIntegration' ./$dir/... || exit 1
  fi
done
"""

[tasks."test:integration:morphir-elm"]
description = "Run morphir-elm toolchain integration tests"
run = "go test -v -run 'TestIntegration_MorphirElmMake' ./pkg/toolchain/"

[tasks."test:bdd"]
description = "Run all BDD tests"
run = "go test -v -run 'TestFeatures' ./tests/bdd/"

# =============================================================================
# Release Tasks
# =============================================================================

[tasks."release:validate"]
description = "Run pre-release validation checks"
run = "./scripts/release-validate.sh"

[tasks."release:validate:json"]
description = "Run pre-release validation with JSON output"
run = "./scripts/release-validate.sh --json"

[tasks."release:verify"]
description = "Verify a completed release (requires VERSION env var)"
run = "./scripts/release-verify.sh ${VERSION:-}"

[tasks."release:tags:list"]
description = "List all tags for a version (requires VERSION env var)"
run = "./scripts/release-tags.sh list ${VERSION:-}"

[tasks."release:tags:create"]
description = "Create all module tags locally (requires VERSION env var)"
run = "./scripts/release-tags.sh create ${VERSION:-}"

[tasks."release:tags:push"]
description = "Push all module tags to remote (requires VERSION env var)"
run = "./scripts/release-tags.sh push ${VERSION:-}"

[tasks."release:tags:delete"]
description = "Delete all module tags (requires VERSION env var)"
run = "./scripts/release-tags.sh delete ${VERSION:-}"

[tasks."release:snapshot"]
description = "Build a local snapshot release (for testing)"
run = "goreleaser release --snapshot --clean"

[tasks."release:check"]
description = "Validate GoReleaser configuration"
run = "goreleaser check"

# =============================================================================
# Workspace Tasks
# =============================================================================

[tasks."workspace:setup"]
description = "Set up Go workspace with all modules"
run = "./scripts/setup-workspace.sh"

[tasks."workspace:doctor"]
description = "Check workspace health and diagnose issues"
run = "./scripts/workspace-doctor.sh"

[tasks."workspace:sync"]
description = "Sync workspace dependencies"
run = "go work sync"
